<div materialize class="issueApproval">

    <!-- Up and Down arrows for navigating through issue items -->
    <div class="issueApproval__navigation">
        <a class="blue lighten-1 btn-floating waves-effect waves-light" (click)="shiftSelectedItem('up')">
            <i class="material-icons">keyboard_arrow_up</i>
        </a>
        <div class="issueApproval__counter">
            {{this.courseService.selectedIssueItem ? this.getCardPosition().currentIndex : '--'}} of {{this.courseService.selectedIssueItem
            ? this.getCardPosition().totalLength : '--'}}
        </div>
        <a class="blue lighten-1 btn-floating waves-effect waves-light" (click)="shiftSelectedItem('down')">
            <i class="material-icons">keyboard_arrow_down</i>
        </a>
    </div>

    <!-- Container to hold the fix approved and kebob menu buttons -->
    <div class="issueApproval__buttonContainer">

        <!-- Fix Approved Button -->
        <div class="issueApproval__button">
            <a class="modal-trigger waves-effect red-text waves-light btn-flat" (click)="openModal('startOver')">
                <i class="material-icons left">refresh</i>
                Start Over
            </a>
        </div>
        <div class="issueApproval__button">
            <a href="#fixModal" class="modal-trigger waves-effect blue waves-light btn" (click)="openModal('fixApproved')">
                <i class="material-icons left">build</i>
                Fix Approved Issues
            </a>
        </div>

        <!-- The dropdown menu from the kebob menu -->
        <ul id="dropdown1" class="dropdown-content">
            <li>
                <a href="#fixModal" class="green-text text-accent-4 modal-trigger" (click)="openModal('approveAll')">
                    Approve All
                </a>
            </li>
            <li>
                <a href="#fixModal" class="grey-text modal-trigger" (click)="openModal('unapproveAll')">
                    Unapprove All
                </a>
            </li>
        </ul>

        <!-- The Kebob menu at the far right of the bottom bar -->
        <div>
            <a materialize="dropdown" [materializeParams]="[{constrain_width: false, alignment: 'left'}]" class="dropdown-button issueApproval_moreButton"
                data-activates="dropdown1">
                <i class="material-icons">more_vert</i>
            </a>
        </div>
    </div>
</div>

<!-- Approve All modal - Must stay beneath the main container -->
<div id="fixModal" class="modal" materialize="modal" [materializeActions]="modalActions">

    <div [ngSwitch]="getModal()">
        <div *ngSwitchCase="'approveAll'">
            <div class="modal-content">
                <h4>Approve all fixes in {{courseService.selectedCourse.course_code}}?</h4>
                <p>This will approve all unapproved fixes in the current course. This will not approve "skipped" fixes.</p>
                <p>
                    <strong>Unapproved Fixes:</strong> {{courseService.getCourseIssueCount('untouched')}}
                </p>
            </div>
            <div class="modal-footer">
                <a class="waves-effect btn-flat blue-grey-text" (click)="closeModal()">Cancel</a>
                <a class="modal-action modal-close waves-effect btn green" (click)="setApproved('approved')">Approve All</a>
            </div>
        </div>

        <div *ngSwitchCase="'unapproveAll'">
            <div class="modal-content">
                <h4>Unapprove all fixes in {{courseService.selectedCourse.course_code}}?</h4>
                <p>This will unapprove all approved fixes in the current course.</p>
                <p>
                    <strong>Approved Fixes:</strong> {{courseService.getCourseIssueCount('approved')}}
                </p>
            </div>
            <div class="modal-footer">
                <a class="waves-effect btn-flat blue-grey-text" (click)="closeModal()">Cancel</a>
                <a class="modal-action modal-close waves-effect btn blue-grey" (click)="setApproved('untouched')">Unapprove All</a>
            </div>
        </div>

        <div *ngSwitchCase="'fixApproved'">
            <div class="modal-content">
                <h4>Fixed all approved issues?</h4>
                <p>This will attempt to fix all approved issues in ALL selected courses. Are you sure?</p>
                <p>
                    <strong>Approved Fixes:</strong> {{courseService.getCourseIssueCount('approved')}}
                </p>
            </div>
            <div class="modal-footer">
                <a class="waves-effect btn-flat blue-grey-text" (click)="closeModal()">Cancel</a>
                <a class="modal-action modal-close waves-effect btn blue" (click)="katanaService.fixIssues()">Fix Approved Issues</a>
            </div>
        </div>

        <div *ngSwitchCase="'startOver'">
            <div class="modal-content">
                <h4>Start Over?</h4>
                <p>This will take you back to the options page, and your progress will be lost.</p>
            </div>
            <div class="modal-footer">
                <a class="waves-effect btn-flat blue-grey-text" (click)="closeModal()">Cancel</a>
                <a class="modal-action modal-close waves-effect btn red" (click)="this.router.navigate(['categories', 'tools', this.toolService.selectedTool.id, 'options'])">Start Over</a>
            </div>
        </div>

        <div *ngSwitchDefault>
            <div class="modal-content">
                <h4>c( '_' c)</h4>
                <p>Something went wrong. Contact a Katana admin. Be entertained by the text-kirby above until the issue is resolved.</p>
            </div>
            <div class="modal-footer">
                <a class="waves-effect btn-flat blue-grey-text" (click)="closeModal()">Cancel</a>
            </div>
        </div>

    </div>
</div>
